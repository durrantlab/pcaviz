var u=function(){function b(a){this.D=this.i=this.G=0;this.c={};this.j=1;this.w=this.F=void 0;this.h=[];this.A=this.J=void 0;this.b={};this.L=void 0;this.v={};this.io=new h(this);this.P(a);void 0!==a.viewer&&(this.viewer=new n(this),this.player=new q(this))}b.prototype.P=function(a){var d=this;this.b=r.extend({viewer:void 0,viewerType:void 0,durationInMilliseconds:1E4,updateFreqInMilliseconds:16.67,loop:!0,caching:"none",cacheModeNum:0,windowAverageSize:1,playerControls:!0,parent:this,loadPDBTxt:function(a){throw Error('You are running BrowserSim in GENERIC mode, but you haven\'t specified a loadPDBTxt(pdbTxt, viewer, browserSim) function. This function loads PDB text into the viewer and optionally returns a model object. For your reference, the current value of the "pdbTxt" variable (a string) starts with:\n\n'+
a.toString().slice(0,500))+'\n\nThe "viewer" variable is the user-specified BrowserSim "viewer" parameter.\n\nThe "browserSim" variable is the instantiated BrowserSim object.\n\n';},updateAtomPositions:function(a){var c="[\n",d;for(d in a)if(a.hasOwnProperty(d)){var b=parseInt(d,10),g=a[d];c+="  Float32Array ["+g[0]+", "+g[1]+", "+g[2]+"],\n";if(10<b)break}throw Error('You are running BrowserSim in GENERIC mode, but you haven\'t specified an updateAtomPositions(newAtomCoors, model, viewer, browserSim) function. This function provides the updated atom coordinates for the current frame. The value of the "newAtomCoors" variable (a list of Float32Array containing the new coordinates of the atoms) looks like:\n\n'+
(c+"  ...\n]")+'\n\nThe "model" variable is whatever your loadPDBTxt(...) function returns.\n\nThe "viewer" variable is the user-specified BrowserSim "viewer" parameter.\n\nThe "browserSim" variable is the instantiated BrowserSim object.\n\n');},render:function(){throw Error('You are running BrowserSim in GENERIC mode, but you haven\'t specified a render(model, viewer, browserSim) function. This function runs every time the atom coordinates change, to update what the viewer renders. The "model" variable is whatever your loadPDBTxt(...) function returns. The "viewer" variable is the user-specified BrowserSim "viewer" parameter. The "browserSim" variable is the instantiated BrowserSim object.\n\n');
}},this.b,a);this.b.halfWindowSize=Math.floor((this.b.windowAverageSize-1)/2);if(void 0===this.b.visStyle)switch(this.b.viewerType){case "3DMOLJS":this.b.visStyle={line:{}};break;case "NGL":this.b.visStyle=void 0;break;case "PV":this.b.visStyle=function(a){d.b.viewer.viewer.spheres("all",a)};break;case "GENERIC":this.b.visStyle=void 0}a=1E3/60;this.b.updateFreqInMilliseconds<a&&(this.b.updateFreqInMilliseconds=a);0<this.G&&(a=this.b.durationInMilliseconds/this.i,this.b.updateFreqInMilliseconds<a&&
(this.b.updateFreqInMilliseconds=a));switch(this.b.caching){case "none":this.b.cacheModeNum=0;break;case "continuous":this.b.cacheModeNum=1;break;case "pre":this.b.cacheModeNum=2;break;default:throw Error("Invalid caching value: "+this.b.caching+'. Valid values are "none", "continuous", and "pre".');}this.ha()};b.prototype.m=function(a){var d=this,c=void 0;if(0===this.b.cacheModeNum||void 0===this.v[a]){c=t.H(a-this.b.halfWindowSize,a+this.b.halfWindowSize+1);var e=c.map(function(a){0>a&&(a+=d.i);
a%=d.i;return d.c[a]}).map(function(a){var c=d.h.map(function(c,d){return t.B(a[d],c)});return t.u(c)}).reduce(function(a,c){return t.u([a,c])}),b=t.B(1/c.length,e);b=t.u([b,this.J]);c=t.H(0,this.w/3).map(function(a){a=3*a;return new Float32Array([b[a],b[a+1],b[a+2]])});0<this.b.cacheModeNum&&(this.v[a]=c)}else c=this.v[a];return c};b.prototype.ha=function(){if(2===this.b.cacheModeNum){this.v={};for(var a=0;a<this.i;a++)console.log("Caching frame",a),this.m(a)}};return b}(),h=function(){function b(a){this.a=
a}b.prototype.loadJSON=function(a,d){var c=this;void 0===d&&(d=function(){});r.M(a,function(a){c.a.D=a.coeffs[0].length;c.a.F=a.vecs.length;if(c.a.D!==c.a.F)throw Error("The number of coefficients per frame "+("("+c.a.D+") is not the same")+("as the number of components ("+c.a.F+")"));var b=Math.pow(10,-a.params.precision);c.ea(a,b);c.fa(a,b);c.ca(a,b);c.da(a,b);c.ga(a);d()})};b.prototype.ea=function(a,d){this.a.G=a.coeffs.length;this.a.c={};this.a.j=a.params.stride;this.a.i=this.a.G*this.a.j;for(var c in a.coeffs)if(a.coeffs.hasOwnProperty(c)){var b=
parseInt(c,10);this.a.c[b*this.a.j]=new Float32Array(a.coeffs[b])}for(c in this.a.c)this.a.c.hasOwnProperty(c)&&(this.a.c[c]=this.a.c[c].map(function(a){return d*a}));a=Object.keys(this.a.c).length*this.a.j;var k=c=void 0;b=void 0;for(var f=0;f<a;f++)void 0!==this.a.c[f]?(c=f,k=f+this.a.j,void 0!==this.a.c[k]&&(b=t.u([this.a.c[k],t.B(-1,this.a.c[c])]))):(k=t.u([this.a.c[c],t.B((f-c)/this.a.j,b)]),this.a.c[f]=k)};b.prototype.fa=function(a,d){this.a.w=a.vecs[0].length;this.a.h=[];for(var c in a.vecs)if(a.vecs.hasOwnProperty(c)){var b=
parseInt(c,10);this.a.h[b]=new Float32Array(a.vecs[b])}for(c in this.a.h)this.a.h.hasOwnProperty(c)&&(a=parseInt(c,10),this.a.h[a]=this.a.h[a].map(function(a){return d*a}))};b.prototype.ca=function(a,d){this.a.J=new Float32Array(a.coors.map(function(a){return d*a}))};b.prototype.da=function(a,d){this.a.A=new Float32Array(a.first_coors.map(function(a){return d*a}))};b.prototype.ga=function(a){var d=this;a=a.res_info;this.a.L=a;var c="0",b="",k="",f=t.H(0,this.a.w/3).map(function(a){a=3*a;return new Float32Array([d.a.A[a],
d.a.A[a+1],d.a.A[a+2]])}),g;for(g in a)if(a.hasOwnProperty(g)){var l=parseInt(g,10),m=a[l];"string"!==typeof m&&(c=m[0].toString(),b=m[1],m=m[2]);var p=f[l];k+=this.K(l,m,b,c,p[0],p[1],p[2])}this.a.viewer.addPDBTxt(k)};b.prototype.K=function(a,b,c,e,k,f,g){var d=b.substr(0,2).toUpperCase();-1==="CL BR ZN MG SE FE AL MN CO NI CU".split(" ").indexOf(d)&&(d=" "+d.charAt(0));return"ATOM  "+this.o(5,a.toString())+this.o(5,b)+this.o(4,c)+" X"+this.o(4,e)+"    "+this.C(k)+this.C(f)+this.C(g)+"  1.00  0.00          "+
d+"  \n"};b.prototype.makePDB=function(){for(var a=this.a.w/3,b="",c=0;c<this.a.i;c++){b+="MODEL "+c.toString()+"\n";for(var e=this.a.m(c),k="",f="",g=0;g<a;g++){var l=this.a.L[g];"string"!==typeof l&&(k=l[0].toString(),f=l[1],l=l[2]);var m=e[g];b+=this.K(g,l,f,k,m[0],m[1],m[2])}b+="ENDMDL\n"}return b};b.prototype.C=function(a){return this.o(8,a.toFixed(3))};b.prototype.o=function(a,b){var c;for(void 0===c&&(c=" ");b.length<a;)b=c+b;return b};return b}(),n=function(){function b(a){this.f=void 0;this.I=
!1;this.l=this.s=void 0;this.a=a;if(void 0===this.a.b.viewer)throw Error("No viewer specified!");if(void 0===this.a.b.viewerType)throw Error("No viewer type specified!");a=["3DMOLJS","NGL","PV","GENERIC"];if(-1===a.indexOf(this.a.b.viewerType))throw Error("Specified viewer type, "+this.a.b.viewerType+", is invalid. Must be one of "+a.join("/"));switch(this.a.b.viewerType){case "3DMOLJS":this.addPDBTxt=this.R;this.s=this.T;this.l=this.S;break;case "NGL":this.addPDBTxt=this.X;this.s=this.Z;this.l=this.Y;
break;case "PV":this.addPDBTxt=this.$;this.s=this.ba;this.l=this.aa;break;case "GENERIC":this.addPDBTxt=this.U;this.s=this.W;this.l=this.V;break;default:throw Error("Invalid viewer type specified: "+this.a.b.viewerType);}}b.prototype.O=function(a){this.I||(this.I=!0,this.s(a),this.I=!1,this.l())};b.prototype.R=function(a){this.f=this.a.b.viewer.addModel(a,"pdb");this.l()};b.prototype.T=function(a){a=this.a.m(a);for(var b=this.f.selectedAtoms({}),c=b.length,e=0;e<c;e++)b[e].x=a[e][0],b[e].y=a[e][1],
b[e].z=a[e][2]};b.prototype.S=function(){this.f.setStyle({},this.a.b.visStyle);this.a.b.viewer.render()};b.prototype.X=function(a){var b=this;this.a.b.viewer.ja(new Blob([a],{type:"text/plain"}),{ext:"pdb",ia:!0}).then(function(a){b.f=a})};b.prototype.Z=function(a){var b=this.a.m(a),c=0;this.f.structure.eachAtom(function(a){a.x=b[c][0];a.y=b[c][1];a.z=b[c][2];c++})};b.prototype.Y=function(){this.f.rebuildRepresentations()};b.prototype.$=function(a){this.f=this.a.b.viewer.library.io.pdb(a)};b.prototype.ba=
function(a){var b=this.a.m(a),c=0;this.f.eachAtom(function(a){a._bV=b[c];c++})};b.prototype.aa=function(){this.a.b.viewer.viewer.clear();this.a.b.visStyle(this.f)};b.prototype.U=function(a){a=this.a.b.loadPDBTxt(a,this.a.b.viewer,this);void 0!==a&&(this.f=a)};b.prototype.W=function(a){a=this.a.m(a);this.a.b.updateAtomPositions(a,this.f,this.a.b.viewer,this)};b.prototype.V=function(){this.a.b.render(this.f,this.a.b.viewer,this)};return b}(),q=function(){function b(a){this.g=void 0;this.a=a}b.prototype.start=
function(a){function b(a){if(a-e>c.a.b.updateFreqInMilliseconds){e=a;a=a/c.a.b.durationInMilliseconds%1;if(!c.a.b.loop&&1<a){c.stop();return}c.a.viewer.O(Math.floor(c.a.i*a))}void 0!==c.g&&requestAnimationFrame(b)}var c=this;this.a.P(a);void 0!==this.g&&cancelAnimationFrame(this.g);var e=0;this.g=requestAnimationFrame(b)};b.prototype.stop=function(){void 0!==this.g&&(cancelAnimationFrame(this.g),this.g=void 0)};b.prototype.toFrame=function(a){this.a.viewer.O(a)};return b}(),t;
(function(b){b.H=function(a,b){for(var c=[];a<b;)c.push(a),a++;return c};b.u=function(a){return 1===a.length?a[0]:a.reduce(function(a,b){return a.map(function(a,c){return a+b[c]})})};b.B=function(a,b){switch(a){case 0:return new Float32Array(b.length);case 1:return b;default:return b.map(function(b){return a*b})}}})(t||(t={}));var r;
(function(b){b.extend=function(a,b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);return a};b.M=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&200==this.status&&b(JSON.parse(this.responseText))};c.open("GET",a,!0);c.send()}})(r||(r={}));var v=!1;try{window}catch(b){v=!0}
if(v){var w=process.argv[2];r.M=function(b,a){b=require("fs").na(w);b=JSON.parse(b);a(b)};var x=new u({pa:{},qa:"GENERIC",ra:1,la:function(){},oa:function(){},render:function(){}});x.N.ka("data.json",function(){var b=x.N.ma.bind(x.N)(void 0);console.log(b)})}else(function(){for(var b=0,a=["ms","moz","webkit","o"],d=0;d<a.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[a[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[d]+"CancelAnimationFrame"]||window[a[d]+
"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-b)),f=window.setTimeout(function(){a(c+d)},d);b=c+d;return f});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})(),window.BrowserSim=u;
