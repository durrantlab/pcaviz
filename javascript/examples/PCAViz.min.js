var PCAVizNameSpace;
(function(r){var n=function(){function b(a){this.J=this.f=this.L=0;this.c={};this.i=1;this.B=this.K=void 0;this.g=[];this.m=this.H=void 0;this.b={};this.R=void 0;this.A={};this.io=new p(this);this.T(a);void 0!==a.viewer&&(this.viewer=new u(this),this.player=new w(this));this.F=new x(this)}b.prototype.T=function(a){var e=this;this.b=t.extend({viewer:void 0,viewerType:void 0,durationInMilliseconds:1E4,updateFreqInMilliseconds:16.67,loop:!0,caching:"none",cacheModeNum:0,windowAverageSize:1,playerControlsID:"",parent:this,
loadPDBTxt:function(a){throw Error('You are running PCAViz in GENERIC mode, but you haven\'t specified a loadPDBTxt(pdbTxt, viewer, pcaViz) function. This function loads PDB text into the viewer and optionally returns a model object. For your reference, the current value of the "pdbTxt" variable (a string) starts with:\n\n'+a.toString().slice(0,500))+'\n\nThe "viewer" variable is the user-specified PCAViz "viewer" parameter.\n\nThe "pcaViz" variable is the instantiated PCAViz object.\n\n';},updateAtomPositions:function(a){var c=
"[\n",e;for(e in a)if(a.hasOwnProperty(e)){var b=+e,f=a[e];c+="  Float32Array ["+f[0]+", "+f[1]+", "+f[2]+"],\n";if(10<b)break}throw Error('You are running PCAViz in GENERIC mode, but you haven\'t specified an updateAtomPositions(newAtomCoors, model, viewer, pcaViz) function. This function provides the updated atom coordinates for the current frame. The value of the "newAtomCoors" variable (a list of Float32Array containing the new coordinates of the atoms) looks like:\n\n'+(c+"  ...\n]")+'\n\nThe "model" variable is whatever your loadPDBTxt(...) function returns.\n\nThe "viewer" variable is the user-specified PCAViz "viewer" parameter.\n\nThe "pcaViz" variable is the instantiated PCAViz object.\n\n');
},render:function(){throw Error('You are running PCAViz in GENERIC mode, but you haven\'t specified a render(model, viewer, pcaViz) function. This function runs every time the atom coordinates change, to update what the viewer renders. The "model" variable is whatever your loadPDBTxt(...) function returns. The "viewer" variable is the user-specified PCAViz "viewer" parameter. The "pcaViz" variable is the instantiated PCAViz object.\n\n');}},this.b,a);this.b.halfWindowSize=Math.floor((this.b.windowAverageSize-
1)/2);if(void 0===this.b.visStyle)switch(this.b.viewerType){case "3DMOLJS":this.b.visStyle={line:{}};break;case "NGL":this.b.visStyle=void 0;break;case "PV":this.b.visStyle=function(a){e.b.viewer.viewer.spheres("all",a)};break;case "GENERIC":this.b.visStyle=void 0}a=1E3/60;this.b.updateFreqInMilliseconds<a&&(this.b.updateFreqInMilliseconds=a);0<this.L&&(a=this.b.durationInMilliseconds/this.f,this.b.updateFreqInMilliseconds<a&&(this.b.updateFreqInMilliseconds=a));switch(this.b.caching){case "none":this.b.cacheModeNum=
0;break;case "continuous":this.b.cacheModeNum=1;break;case "pre":this.b.cacheModeNum=2;break;default:throw Error("Invalid caching value: "+this.b.caching+'. Valid values are "none", "continuous", and "pre".');}this.la()};b.prototype.l=function(a){if(0===this.b.cacheModeNum||void 0===this.A[a]){var e=h.M(a-this.b.halfWindowSize,a+this.b.halfWindowSize+1);for(var c=e.length,d=Array(c),k=0;k<c;k++){var b=e[k];0>b&&(b+=this.f);b%=this.f;d[k]=this.c[b]}c=d.length;b=this.g.length;var f=Array(c);for(k=0;k<
c;k++){for(var g=d[k],l=Array(b),q=0;q<b;q++)l[q]=h.G(g[q],this.g[q]);g=h.w(l);f[k]=g}c=h.w(f);d=h.G(1/e.length,c);d=h.w([d,this.H]);b=h.M(0,this.B/3);c=b.length;e=Array(c);for(f=0;f<c;f++)k=b[f],k=3*k,e[f]=new Float32Array([d[k],d[k+1],d[k+2]]);0<this.b.cacheModeNum&&(this.A[a]=e)}else e=this.A[a];return e};b.prototype.la=function(){if(2===this.b.cacheModeNum){this.A={};for(var a=0;a<this.f;a++)this.l(a)}};return b}();r.U=n;var p=function(){function b(a){this.a=a}b.prototype.loadJSON=function(a,
e){var c=this;void 0===e&&(e=function(){});t.ma(a,function(a){c.a.J=a.coeffs[0].length;c.a.K=a.vecs.length;if(c.a.J!==c.a.K)throw Error("The number of coefficients per frame "+("("+c.a.J+") is not the same")+("as the number of components ("+c.a.K+")"));var d=Math.pow(10,-a.params.precision);c.ia(a,d);c.ja(a,d);c.ga(a,d);c.ha(a,d);c.ka(a);e()})};b.prototype.ia=function(a,e){this.a.L=a.coeffs.length;this.a.c={};this.a.i=a.params.stride;this.a.f=this.a.L*this.a.i;for(var c=a.coeffs.length,d=0;d<c;d++)this.a.c[d*
this.a.i]=new Float32Array(a.coeffs[d]);c=this.a.c[0].length;a=Object.keys(this.a.c);for(var b=a.length,m=0;m<b;m++){d=+a[m];for(var f=0;f<c;f++)this.a.c[d][f]*=e}e=Object.keys(this.a.c).length*this.a.i;d=c=void 0;for(a=0;a<e;a++)void 0!==this.a.c[a]?(c=a,b=a+this.a.i,void 0!==this.a.c[b]&&(d=h.w([this.a.c[b],h.G(-1,this.a.c[c])]))):(b=h.w([this.a.c[c],h.G((a-c)/this.a.i,d)]),this.a.c[a]=b)};b.prototype.ja=function(a,e){this.a.B=a.vecs[0].length;this.a.g=[];for(var c=a.vecs.length,d=0;d<c;d++)this.a.g[d]=
new Float32Array(a.vecs[d]);c=this.a.g.length;a=this.a.g[0].length;for(d=0;d<c;d++)for(var b=0;b<a;b++)this.a.g[d][b]*=e};b.prototype.ga=function(a,e){var c=a.coors.length;this.a.H=new Float32Array(c);for(var d=0;d<c;d++)this.a.H[d]=e*a.coors[d]};b.prototype.ha=function(a,e){var c=a.first_coors.length;this.a.m=new Float32Array(c);for(var d=0;d<c;d++)this.a.m[d]=e*a.first_coors[d]};b.prototype.ka=function(a){a=a.res_info;this.a.R=a;for(var e="0",c="",d="",b=h.M(0,this.a.B/3),m=b.length,f=Array(m),
g=0;g<m;g++){var l=3*b[g];f[g]=new Float32Array([this.a.m[l],this.a.m[l+1],this.a.m[l+2]])}m=a.length;for(b=0;b<m;b++)g=a[b],"string"!==typeof g&&(e=g[0].toString(),c=g[1],g=g[2]),l=f[b],d+=this.P(b,g,c,e,l[0],l[1],l[2]);this.a.viewer.addPDBTxt(d)};b.prototype.P=function(a,e,c,d,b,m,f){var g=e.substr(0,2).toUpperCase();-1==="CL BR ZN MG SE FE AL MN CO NI CU".split(" ").indexOf(g)&&(g=" "+g.charAt(0));return"ATOM  "+this.o(5,a.toString())+this.o(5,e)+this.o(4,c)+" X"+this.o(4,d)+"    "+this.I(b)+this.I(m)+
this.I(f)+"  1.00  0.00          "+g+"  \n"};b.prototype.makePDB=function(){for(var a=this.a.B/3,b="",c=0;c<this.a.f;c++){b+="MODEL "+c.toString()+"\n";for(var d=this.a.l(c),k="",m="",f=0;f<a;f++){var g=this.a.R[f];"string"!==typeof g&&(k=g[0].toString(),m=g[1],g=g[2]);var h=d[f];b+=this.P(f,g,m,k,h[0],h[1],h[2])}b+="ENDMDL\n"}return b};b.prototype.I=function(a){return this.o(8,a.toFixed(3))};b.prototype.o=function(a,b){var c;for(void 0===c&&(c=" ");b.length<a;)b=c+b;return b};return b}(),u=function(){function b(a){this.N=
!1;this.a=this.j=this.v=void 0;this.a=a;this._model={rebuildRepresentations:function(){},structure:{eachAtom:function(){}}};if(void 0===this.a.b.viewer)throw Error("No viewer specified!");if(void 0===this.a.b.viewerType)throw Error("No viewer type specified!");a=["3DMOLJS","NGL","PV","GENERIC"];if(-1===a.indexOf(this.a.b.viewerType))throw Error("Specified viewer type, "+this.a.b.viewerType+", is invalid. Must be one of "+a.join("/"));switch(this.a.b.viewerType){case "3DMOLJS":this.addPDBTxt=this.V;
this.v=this.X;this.j=this.W;break;case "NGL":this.addPDBTxt=this.aa;this.v=this.ca;this.j=this.ba;break;case "PV":this.addPDBTxt=this.da;this.v=this.fa;this.j=this.ea;break;case "GENERIC":this.addPDBTxt=this.Y;this.v=this.$;this.j=this.Z;break;default:throw Error("Invalid viewer type specified: "+this.a.b.viewerType);}}b.prototype.S=function(a){this.N||(this.N=!0,this.v(a),this.N=!1,this.j())};b.prototype.V=function(a){this._model=this.a.b.viewer.addModel(a,"pdb",{keepH:!0});this.j()};b.prototype.X=
function(a){a=this.a.l(a);for(var b=this._model.selectedAtoms({}),c=b.length,d=0;d<c;d++)b[d].x=a[d][0],b[d].y=a[d][1],b[d].z=a[d][2]};b.prototype.W=function(){this._model.setStyle({},this.a.b.visStyle);this.a.b.viewer.render()};b.prototype.aa=function(a){var b=this;this.a.b.viewer.loadFile(new Blob([a],{type:"text/plain"}),{ext:"pdb",defaultRepresentation:!0}).then(function(a){b._model=a})};b.prototype.ca=function(a){var b=this.a.l(a),c=0;this._model.structure.eachAtom(function(a){a.x=b[c][0];a.y=
b[c][1];a.z=b[c][2];c++})};b.prototype.ba=function(){this._model.rebuildRepresentations()};b.prototype.da=function(a){this._model=this.a.b.viewer.library.io.pdb(a)};b.prototype.fa=function(a){var b=this.a.l(a),c=0;this._model.eachAtom(function(a){a._bV=b[c];c++})};b.prototype.ea=function(){this.a.b.viewer.viewer.clear();this.a.b.visStyle(this._model)};b.prototype.Y=function(a){a=this.a.b.loadPDBTxt(a,this.a.b.viewer,this);void 0!==a&&(this._model=a)};b.prototype.$=function(a){a=this.a.l(a);this.a.b.updateAtomPositions(a,
this._model,this.a.b.viewer,this)};b.prototype.Z=function(){this.a.b.render(this._model,this.a.b.viewer,this)};return b}(),w=function(){function b(a){var b=this;this.a=this.h=void 0;this.a=a;window.onblur=function(){b.stop()}}b.prototype.start=function(a){function b(a){h=void 0===h?a:h;a-=h;f=a-d;if(f>c.a.b.updateFreqInMilliseconds){d=a;g=(k+a/c.a.b.durationInMilliseconds)%1;if(!c.a.b.loop&&1<g){c.stop();return}l=Math.floor(c.a.f*g);c.a.viewer.S(l);c.a.F.qa(l)}void 0!==c.h&&requestAnimationFrame(b)}
var c=this;this.a.T(a);void 0!==this.h&&cancelAnimationFrame(this.h);var d=0,k=this.a.F.na(),h=void 0,f=void 0,g=void 0,l=void 0;this.h=requestAnimationFrame(b);this.a.F.oa()};b.prototype.stop=function(){void 0!==this.h&&(cancelAnimationFrame(this.h),this.h=void 0);this.a.F.pa()};b.prototype.toFrame=function(a){this.a.viewer.S(a)};return b}(),h;(function(b){b.M=function(a,b){for(var c=[];a<b;)c.push(a),a++;return c};b.w=function(a){var b=a.length;if(1===b)return a[0];for(var c=a[0].length,d=new Float32Array(c),
k=0;k<b;k++)for(var h=a[k],f=0;f<c;f++)d[f]=h[f]+d[f];return d};b.G=function(a,b){var c=b.length;switch(a){case 0:return new Float32Array(c);case 1:return b;default:for(var d=new Float32Array(c),e=0;e<c;e++)d[e]=a*b[e];return d}}})(h||(h={}));var x=function(){function b(a){var b=this;this.s=this.C=this.D=this.a=void 0;this.u=!1;this.O={play:"data:image/svg+xml;charset=utf-8;base64,PHN2ZyB2ZXJzaW9uPSIxLjIiIGJhc2VQcm9maWxlPSJ0aW55IiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayINCng9IjBweCIgeT0iMHB4IiB3aWR0aD0iNDBweCIgaGVpZ2h0PSI0MHB4IiB2aWV3Qm94PSIwIDAgNDAgNDAiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggZmlsbD0iIzAxMDEwMSIgc3Ryb2tlPSIjMDEwMTAxIiBzdHJva2Utd2lkdGg9IjYuNjQ0OSIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTcuMSwzNi40TDMyLjksMjBMNy4xLDMuNlYzNi40eiIvPg0KPC9zdmc+",
pause:"data:image/svg+xml;charset=utf-8;base64,PHN2ZyB2ZXJzaW9uPSIxLjIiIGJhc2VQcm9maWxlPSJ0aW55IiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayINCng9IjBweCIgeT0iMHB4IiB3aWR0aD0iNDBweCIgaGVpZ2h0PSI0MHB4IiB2aWV3Qm94PSIwIDAgNDAgNDAiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGc+DQo8cGF0aCBmaWxsPSIjMDEwMTAxIiBzdHJva2U9IiMwMTAxMDEiIHN0cm9rZS13aWR0aD0iNi40MTM0IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMy43LDMuNUgxNWMwLjEsMCwwLjEsMC4xLDAuMSwwLjN2MzIuMw0KYzAsMC4yLTAuMSwwLjMtMC4xLDAuM0gzLjdjLTAuMSwwLTAuMS0wLjEtMC4xLTAuM1YzLjlDMy41LDMuNywzLjYsMy41LDMuNywzLjUiLz4NCjxwYXRoIGZpbGw9IiMwMTAxMDEiIHN0cm9rZT0iIzAxMDEwMSIgc3Ryb2tlLXdpZHRoPSI2LjQxMzQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0yNSwzLjVoMTEuNGMwLjEsMCwwLjEsMC4xLDAuMSwwLjN2MzIuMw0KYzAsMC4yLTAuMSwwLjMtMC4xLDAuM0gyNWMtMC4xLDAtMC4xLTAuMS0wLjEtMC4zVjMuOUMyNC44LDMuNywyNC45LDMuNSwyNSwzLjUiLz4NCjwvZz4NCjwvc3ZnPg=="};
this.a=a;if(""!==this.a.b.playerControlsID){this.u=!0;a=document.getElementById(this.a.b.playerControlsID);var c="id "+Math.random().toString().replace(/\./g,"");a.innerHTML='\n                    <div class="pcaviz-controls-container" style="display: flex; flex-direction: row;">\n                        <div class="pcaviz-button-container" style="flex: none;">\n                            <button id="'+c+'-play" class="pcaviz-play pcaviz-button" style="height: 100%;">\n                                <img src="'+
this.O.play+'" />\n                            </button>\n                            <button id="'+c+'-pause" class="pcaviz-pause pcaviz-button" style="height: 100%; display: none;">\n                                <img src="'+this.O.pause+'" />\n                            </button>\n                        </div>\n                        <div class="pcaviz-slider-container" style="flex: auto; display: inline-flex;">\n                            <input id="'+c+'-slider" type="range" min="0" max="100" value="0" style="width: 100%;">\n                        </div>\n                    </div>\n                ';
this.D=document.getElementById(c+"-play");this.C=document.getElementById(c+"-pause");this.s=document.getElementById(c+"-slider");this.D.addEventListener("click",function(){b.a.player.start(b.a.b)});this.C.addEventListener("click",function(){b.a.player.stop()});this.s.onchange=function(){b.a.player.toFrame(Math.round(b.s.value/100*b.a.f))}}}b.prototype.oa=function(){!0===this.u&&(this.D.style.display="none",this.C.style.display="block")};b.prototype.pa=function(){!0===this.u&&(this.D.style.display=
"block",this.C.style.display="none")};b.prototype.qa=function(a){!0===this.u&&(this.s.value=Math.round(100*a/this.a.f))};b.prototype.na=function(){return!0===this.u?this.s.value/100:0};return b}(),t;(function(b){b.extend=function(a,b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);return a};b.ma=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&200==this.status&&b(JSON.parse(this.responseText))};c.open("GET",a,
!0);c.send()}})(t||(t={}))})(PCAVizNameSpace||(PCAVizNameSpace={}));
(function(){for(var r=0,n=["ms","moz","webkit","o"],p=0;p<n.length&&!window.requestAnimationFrame;++p)window.requestAnimationFrame=window[n[p]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[p]+"CancelAnimationFrame"]||window[n[p]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(p){var n=(new Date).getTime(),h=Math.max(0,16-(n-r)),u=window.setTimeout(function(){p(n+h)},h);r=n+h;return u});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(n){clearTimeout(n)})})();window.PCAViz=window.PCAVizNameSpace.U;
