var p=function(){function b(a){this.B=this.i=0;this.f={};this.g=1;this.m=this.o=void 0;this.w=[];this.W=void 0;this.b={};this.io=new e(this);this.I(a);void 0!==a.viewer&&(this.viewer=new l(this),this.player=new m(this))}b.prototype.I=function(a){var d=this;this.b=jQuery.extend({viewer:void 0,viewerType:void 0,durationInMilliseconds:1E4,updateFreqInMilliseconds:10,loop:!0,windowAverageSize:1,parent:this,loadPDBTxt:function(c){throw Error('You are running PCAViz in GENERIC mode, but you haven\'t specified a loadPDBTxt(pdbTxt, viewer, pcaViz) function. This function loads PDB text into the viewer and optionally returns a model object. For your reference, the current value of the "pdbTxt" variable (a string) starts with:\n\n'+
c.toString().slice(0,500))+'\n\nThe "viewer" variable is the user-specified PCAViz "viewer" parameter.\n\nThe "pcaViz" variable is the instantiated PCAViz object.\n\n';},updateAtomPositions:function(c){var a="[\n",d;for(d in c)if(c.hasOwnProperty(d)){var b=parseInt(d,10),k=c[d];a+="  Float32Array ["+k[0]+", "+k[1]+", "+k[2]+"],\n";if(10<b)break}throw Error('You are running PCAViz in GENERIC mode, but you haven\'t specified an updateAtomPositions(newAtomCoors, model, viewer, pcaViz) function. This function provides the updated atom coordinates for the current frame. The value of the "newAtomCoors" variable (a list of Float32Array containing the new coordinates of the atoms) looks like:\n\n'+
(a+"  ...\n]")+'\n\nThe "model" variable is whatever your loadPDBTxt(...) function returns.\n\nThe "viewer" variable is the user-specified PCAViz "viewer" parameter.\n\nThe "pcaViz" variable is the instantiated PCAViz object.\n\n');},render:function(){throw Error('You are running PCAViz in GENERIC mode, but you haven\'t specified a render(model, viewer, pcaViz) function. This function runs every time the atom coordinates change, to update what the viewer renders. The "model" variable is whatever your loadPDBTxt(...) function returns. The "viewer" variable is the user-specified PCAViz "viewer" parameter. The "pcaViz" variable is the instantiated PCAViz object.\n\n');
}},this.b,a);this.b.halfWindowSize=Math.floor((this.b.windowAverageSize-1)/2);if(void 0===this.b.visStyle)switch(this.b.viewerType){case "3DMOLJS":this.b.visStyle={line:{}};break;case "NGL":this.b.visStyle=void 0;break;case "PV":this.b.visStyle=function(c){d.b.viewer.viewer.spheres("all",c)};break;case "GENERIC":this.b.visStyle=void 0}};b.prototype.s=function(a){var d=this;a=n.D(a-this.b.halfWindowSize,a+this.b.halfWindowSize+1);var c=a.map(function(c){0>c&&(c+=d.i);c%=d.i;return d.f[c]}).map(function(c){var a=
d.w.map(function(a,d){return n.u(c[d],a)});return n.v(a)}).reduce(function(c,a){return n.v([c,a])}),b=n.u(1/a.length,c);return n.D(0,this.m/3).map(function(c){return new Float32Array([b[c],b[c+1],b[c+2]])})};return b}(),e=function(){function b(a){this.a=a}b.prototype.loadJSON=function(a,d){var c=this;void 0===d&&(d=function(){});jQuery.getJSON(a,function(a){c.a.i=a.frames.length;c.a.B=a.frames[0].length;c.a.f={};c.a.g=5;c.a.o=a.vectors.length;c.a.m=a.vectors[0].length;c.a.w=[];c.a.W=new Float32Array(c.a.o*
c.a.m);if(c.a.B!==c.a.o)throw Error("The number of coefficients per frame "+("("+c.a.B+") is not the same")+("as the number of components ("+c.a.o+")"));for(var d in a.frames)if(a.frames.hasOwnProperty(d)){var b=parseInt(d,10);c.a.f[b*c.a.g]=new Float32Array(a.frames[b])}for(b=0;b<a.frames.length*c.a.g;b++)if(void 0===c.a.f[b]){var f=c.a.g*Math.floor(b/c.a.g),g=f+c.a.g;if(void 0!==c.a.f[f]&&void 0!==c.a.f[g]){var q=(b-f)/c.a.g;g=n.v([c.a.f[f],n.u(-1,c.a.f[g])]);f=n.v([c.a.f[f],n.u(q,g)]);c.a.f[b]=
f}}for(d in a.vectors)a.vectors.hasOwnProperty(d)&&(b=parseInt(d,10),c.a.w[b]=new Float32Array(a.vectors[b]))}).done(function(){d()}).fail(function(){console.log("error")})};b.prototype.makePDB=function(){for(var a=this.a.m/3,d="",c=0;c<this.a.i;c++){d+="MODEL "+c.toString()+"\n";for(var b=0;b<a;b++){var h=this.a.Y(c,b);d+="ATOM  "+this.F(5,b.toString())+"  X   XXX X 852    "+this.A(h[0])+this.A(h[1])+this.A(h[2])+"  1.00  0.00           X  \n"}d+="ENDMDL\n"}return d};b.prototype.A=function(a){return this.F(8,
a.toFixed(3))};b.prototype.F=function(a,d){var c;for(void 0===c&&(c=" ");d.length<a;)d=c+d;return d};return b}(),l=function(){function b(a){this.c=void 0;this.C=!1;this.h=this.l=void 0;this.a=a;if(void 0===this.a.b.viewer)throw Error("No viewer specified!");if(void 0===this.a.b.viewerType)throw Error("No viewer type specified!");a=["3DMOLJS","NGL","PV","GENERIC"];if(-1===a.indexOf(this.a.b.viewerType))throw Error("Specified viewer type, "+this.a.b.viewerType+", is invalid. Must be one of "+a.join("/"));
switch(this.a.b.viewerType){case "3DMOLJS":this.addPDBTxt=this.J;this.l=this.L;this.h=this.K;break;case "NGL":this.addPDBTxt=this.P;this.l=this.S;this.h=this.R;break;case "PV":this.addPDBTxt=this.T;this.l=this.V;this.h=this.U;break;case "GENERIC":this.addPDBTxt=this.M;this.l=this.O;this.h=this.N;break;default:throw Error("Invalid viewer type specified: "+this.a.b.viewerType);}}b.prototype.H=function(a){this.C||(this.C=!0,this.l(a),this.C=!1,this.h())};b.prototype.J=function(a){this.c=this.a.b.viewer.addModel(a,
"pdb");this.h()};b.prototype.L=function(a){a=this.a.s(a);for(var d=this.c.selectedAtoms({}),c=0;c<d.length;c++){var b=a[c];d[c].x=b[0];d[c].y=b[1];d[c].z=b[2]}};b.prototype.K=function(){this.c.setStyle({},this.a.b.visStyle);this.a.b.viewer.render()};b.prototype.P=function(a){var b=this;this.a.b.viewer.Z(new Blob([a],{type:"text/plain"}),{ext:"pdb",X:!0}).then(function(a){b.c=a})};b.prototype.S=function(a){var b=this.a.s(a),c=0;this.c.structure.eachAtom(function(a){var d=b[c];a.x=d[0];a.y=d[1];a.z=
d[2];c++})};b.prototype.R=function(){this.c.rebuildRepresentations()};b.prototype.T=function(a){this.c=this.a.b.viewer.library.io.pdb(a)};b.prototype.V=function(a){var b=this.a.s(a),c=0;this.c.eachAtom(function(a){a._bV=b[c];c++})};b.prototype.U=function(){this.a.b.viewer.viewer.clear();this.a.b.visStyle(this.c)};b.prototype.M=function(a){a=this.a.b.loadPDBTxt(a,this.a.b.viewer,this);void 0!==a&&(this.c=a)};b.prototype.O=function(a){a=this.a.s(a);this.a.b.updateAtomPositions(a,this.c,this.a.b.viewer,
this)};b.prototype.N=function(){this.a.b.render(this.c,this.a.b.viewer,this)};return b}(),m=function(){function b(a){this.j=this.G=void 0;this.a=a}b.prototype.start=function(a){var b=this;this.G=(new Date).getTime();this.a.I(a);void 0!==this.j&&clearInterval(this.j);this.j=setInterval(function(){var a=((new Date).getTime()-b.G)/b.a.b.durationInMilliseconds;!b.a.b.loop&&1<a?b.stop():b.a.viewer.H(Math.floor(b.a.i*a))},this.a.b.updateFreqInMilliseconds)};b.prototype.stop=function(){void 0!==this.j&&
clearInterval(this.j)};b.prototype.toFrame=function(a){this.a.viewer.H(a)};return b}(),n;(function(b){b.D=function(a,b){for(var c=[];a<b;)c.push(a),a++;return c};b.v=function(a){return 1===a.length?a[0]:a.reduce(function(a,c){return a.map(function(a,b){return a+c[b]})})};b.u=function(a,b){switch(a){case 0:return new Float32Array(b.length);case 1:return b;default:return b.map(function(b){return a*b})}}})(n||(n={}));window.PCAViz=p;
